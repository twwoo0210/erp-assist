import{u as I,r as o,j as e,s as i}from"./index-CyyTbw2E.js";function P(){const p=I(),[g,y]=o.useState([{id:"1",type:"system",content:'ì•ˆë…•í•˜ì„¸ìš”! ERP Assist AIì…ë‹ˆë‹¤. ìì—°ì–´ë¡œ ë°œì£¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ì˜ˆ: "Aê±°ë˜ì²˜, ê¹ì‡¼ìƒˆìš° 100ê°œ, ìƒˆìš°ë³¼ 50ê°œ"',timestamp:new Date().toLocaleTimeString()}]),[d,h]=o.useState(""),[c,m]=o.useState(!1),[x,u]=o.useState(null),f=o.useRef(null);o.useEffect(()=>{document.title="AI ì „í‘œì…ë ¥ - ERP Assist | ìì—°ì–´ë¡œ ê°„í¸í•œ ì „í‘œ ìƒì„±";const s=document.querySelector('meta[name="description"]');s&&s.setAttribute("content","ìì—°ì–´ë¡œ ê°„í¸í•˜ê²Œ ì „í‘œë¥¼ ìƒì„±í•˜ì„¸ìš”. AIê°€ ì „í™”, ì¹´í†¡, ì—‘ì…€ ì£¼ë¬¸ ë‚´ìš©ì„ ìë™ ë¶„ì„í•˜ì—¬ ì´ì¹´ìš´íŠ¸ ERP ì „í‘œë¡œ ë³€í™˜í•©ë‹ˆë‹¤.");const t=document.createElement("script");return t.type="application/ld+json",t.textContent=JSON.stringify({"@context":"https://schema.org","@type":"WebPage",name:"AI ì „í‘œì…ë ¥",description:"ìì—°ì–´ë¡œ ê°„í¸í•˜ê²Œ ì „í‘œë¥¼ ìƒì„±í•˜ëŠ” AI ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤",url:`${window.location.origin}/chat`,isPartOf:{"@type":"WebSite",name:"ERP Assist",url:window.location.origin}}),document.head.appendChild(t),()=>{const r=document.querySelector('script[type="application/ld+json"]');r&&r.parentNode&&r.parentNode.removeChild(r)}},[]);const b=()=>{f.current?.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{b()},[g]);const l=(s,t,r)=>{const a={id:Date.now().toString(),type:s,content:t,timestamp:new Date().toLocaleTimeString(),data:r};y(n=>[...n,a])},j=async s=>{try{console.log("AI íŒŒì‹± ì‹œì‘:",s);const{data:t,error:r}=await i.functions.invoke("ai-parse-order",{body:{inputText:s}});if(console.log("AI íŒŒì‹± ì‘ë‹µ:",{data:t,error:r}),r)throw console.error("Supabase function error:",r),new Error(r.message||"AI íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");if(!t)throw new Error("AI íŒŒì‹± ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");return t}catch(t){throw console.error("AI Parse Error:",t),t.name==="TypeError"&&t.message.includes("fetch")?new Error("ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”."):t.name==="AbortError"?new Error("ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."):new Error(t.message||"AI íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},w=async s=>{m(!0);let t=null;try{try{const{data:{user:a}}=await i.auth.getUser();if(a){const{data:n}=await i.from("profiles").select("organization_id").eq("id",a.id).single();if(n?.organization_id){const{data:A}=await i.from("order_logs").insert({organization_id:n.organization_id,user_id:a.id,raw_input_text:s,status:"pending"}).select().single();t=A?.id}}}catch(a){console.warn("ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:",a)}const r=await j(s);if(u(r),l("ai","AIê°€ ë‹¤ìŒê³¼ ê°™ì´ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”:",r),t)try{await i.from("order_logs").update({parsed_data:r,status:"success"}).eq("id",t)}catch(a){console.warn("ë¡œê·¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",a)}}catch(r){if(console.error("AI Processing Error:",r),l("ai",`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${r.message}`),t)try{await i.from("order_logs").update({status:"failed",error_message:r.message}).eq("id",t)}catch(a){console.warn("ë¡œê·¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",a)}}finally{m(!1)}},N=async()=>{if(x){m(!0),l("system","ì´ì¹´ìš´íŠ¸ ERPì— ì „í‘œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...");try{const{data:s,error:t}=await i.functions.invoke("ecount-create-order",{body:{orderData:x}});if(t)throw new Error(t.message||"ì „í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");l("ai",`ì „í‘œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì „í‘œë²ˆí˜¸: ${s?.orderNo||"N/A"}`),u(null);try{const{data:{user:r}}=await i.auth.getUser();if(r){const{data:a}=await i.from("profiles").select("organization_id").eq("id",r.id).single();if(a?.organization_id){const{data:n}=await i.from("order_logs").select("id").eq("organization_id",a.organization_id).eq("user_id",r.id).order("created_at",{ascending:!1}).limit(1).single();n&&await i.from("order_logs").update({ecount_response:s,status:"success"}).eq("id",n.id)}}}catch(r){console.warn("ë¡œê·¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",r)}}catch(s){console.error("Order Creation Error:",s),l("ai",`ì „í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${s.message}`)}finally{m(!1)}}},v=(s,t,r)=>{if(!x)return;const a={...x};a.items[s].qty=parseInt(r)||0,u(a)},_=async s=>{if(s.preventDefault(),!d.trim()||c)return;const t=d.trim();h(""),l("user",t),await w(t)},E=s=>s.type==="user"?e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("div",{className:"bg-blue-600 text-white rounded-lg px-4 py-2 max-w-xs lg:max-w-md",children:[e.jsx("p",{children:s.content}),e.jsx("p",{className:"text-xs text-blue-100 mt-1",children:s.timestamp})]})},s.id):s.type==="system"?e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-100 text-gray-600 rounded-lg px-4 py-2 text-sm",children:s.content})},s.id):e.jsx("div",{className:"flex justify-start mb-4",children:e.jsxs("div",{className:"bg-white border rounded-lg px-4 py-2 max-w-xs lg:max-w-2xl shadow-sm",children:[e.jsx("p",{className:"mb-2",children:s.content}),s.data&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"ì£¼ë¬¸ ë‚´ì—­ í™•ì¸"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ê±°ë˜ì²˜: "}),e.jsx("span",{className:"font-medium",children:s.data.customer_name})]}),e.jsx("div",{className:"space-y-3",children:s.data.items?.map((t,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.matched_item?.name||t.item_name}),t.confidence&&e.jsxs("span",{className:"text-xs text-gray-500",children:["ë§¤ì¹­ë„: ",Math.round(t.confidence*100),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"í’ˆëª©ì½”ë“œ: "}),e.jsx("span",{className:"font-mono",children:t.matched_item?.code||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ìˆ˜ëŸ‰: "}),e.jsx("input",{type:"number",value:t.qty,onChange:a=>v(r,"qty",a.target.value),className:"w-16 px-1 py-0.5 border border-gray-300 rounded text-center"}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:t.matched_item?.unit||"ê°œ"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ë‹¨ê°€: "}),e.jsxs("span",{className:"font-medium",children:["â‚©",(t.matched_item?.price||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"mt-2 text-right text-sm font-medium text-blue-600",children:["ì†Œê³„: â‚©",((t.matched_item?.price||0)*t.qty).toLocaleString()]})]},r))}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"text-right text-lg font-bold text-gray-900",children:["ì´ì•¡: â‚©",s.data.items?.reduce((t,r)=>t+(r.matched_item?.price||0)*r.qty,0).toLocaleString()]})}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:N,disabled:c,className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 cursor-pointer whitespace-nowrap",children:c?"ì²˜ë¦¬ì¤‘...":"ì „í‘œ ìƒì„±"}),e.jsx("button",{onClick:()=>u(null),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 cursor-pointer whitespace-nowrap",children:"ì·¨ì†Œ"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:s.timestamp})]})},s.id);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>p("/dashboard"),className:"text-gray-600 hover:text-gray-900 cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-xl"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 cursor-pointer",onClick:()=>p("/"),children:"AI ì „í‘œì…ë ¥"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"ERP ì—°ë™ë¨"}),e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[g.map(s=>E(s)),e.jsx("div",{ref:f})]})}),e.jsx("div",{className:"bg-white border-t",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("form",{onSubmit:_,className:"flex gap-3",children:[e.jsx("input",{type:"text",value:d,onChange:s=>h(s.target.value),placeholder:"ì˜ˆ: Aê±°ë˜ì²˜, ê¹ì‡¼ìƒˆìš° 100ê°œ, ìƒˆìš°ë³¼ 50ê°œ",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",disabled:c}),e.jsx("button",{type:"submit",disabled:!d.trim()||c,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer whitespace-nowrap",children:c?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsx("i",{className:"ri-send-plane-line"})})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:'ğŸ’¡ íŒ: "ê±°ë˜ì²˜ëª…, í’ˆëª©ëª… ìˆ˜ëŸ‰" í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ë©´ ë” ì •í™•í•©ë‹ˆë‹¤'})]})})]})}export{P as default};
//# sourceMappingURL=page-BwirIM09.js.map
