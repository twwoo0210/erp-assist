import{b as O,u as P,r as a,j as e,s as g}from"./index-CyyTbw2E.js";function $(){const{user:S,ecountConnection:A,loading:x}=O(),u=P(),[o,f]=a.useState(""),[l,h]=a.useState(null),[n,m]=a.useState([]),[j,p]=a.useState(!1),[y,N]=a.useState(!1),[v,w]=a.useState(!1),[k,i]=a.useState(""),[I,C]=a.useState("");if(!x&&!S)return u("/auth/login"),null;if(!x&&A?.status!=="connected")return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6 text-center",children:[e.jsx("i",{className:"ri-link-unlink text-4xl text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Ecount 연결 필요"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"AI 주문 입력을 사용하려면 먼저 Ecount 시스템과 연결해야 합니다."}),e.jsxs("button",{onClick:()=>u("/settings/ecount"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 whitespace-nowrap",children:[e.jsx("i",{className:"ri-settings-line mr-2"}),"Ecount 연결 설정"]})]})});const E=async()=>{if(o.trim()){p(!0),i(""),h(null);try{const{data:s,error:t}=await g.functions.invoke("ai-parse-order",{body:{inputText:o.trim()}});if(t)throw t;h(s),m(s.items||[])}catch(s){i(s.message||"AI 주문 분석 중 오류가 발생했습니다.")}finally{p(!1)}}},F=async()=>{if(l?.items?.length){N(!0),i("");try{const s=[];for(const t of l.items)try{const{data:r,error:c}=await g.functions.invoke("ecount-items-search",{body:{keyword:t.name}});if(c)throw c;if(r.items&&r.items.length>0){const b=r.items[0];s.push({...t,code:b.code,price:b.price||t.price,unit:b.unit||t.unit})}else s.push(t)}catch(r){console.error(`Error searching item ${t.name}:`,r),s.push(t)}m(s)}catch(s){i(s.message||"품목 검색 중 오류가 발생했습니다.")}finally{N(!1)}}},d=(s,t,r)=>{const c=[...n];c[s]={...c[s],[t]:r},m(c)},q=async()=>{if(!(!l?.customer||!n.length)){w(!0),i(""),C("");try{const{data:s,error:t}=await g.functions.invoke("ecount-sales-create",{body:{customer:{name:l.customer},items:n,type:"sale"}});if(t)throw t;C(`전표가 성공적으로 생성되었습니다. 전표번호: ${s.slip_no} (추적ID: ${s.trace_id})`),f(""),h(null),m([])}catch(s){i(s.message||"전표 생성 중 오류가 발생했습니다.")}finally{w(!1)}}};return x?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AI 주문 입력"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"자연어로 주문 내용을 입력하면 AI가 분석하여 Ecount 전표를 생성합니다"})]}),e.jsxs("button",{onClick:()=>u("/dashboard"),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 whitespace-nowrap",children:[e.jsx("i",{className:"ri-arrow-left-line mr-2"}),"대시보드로 돌아가기"]})]})})}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"주문 내용 입력"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"orderInput",className:"block text-sm font-medium text-gray-700",children:"주문 내용"}),e.jsx("div",{className:"mt-1",children:e.jsx("textarea",{id:"orderInput",rows:4,value:o,onChange:s=>f(s.target.value),className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"예: A거래처, 깐소새우 96개, 새우볼 50개"})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"거래처명과 품목, 수량을 자연어로 입력하세요"})]}),e.jsx("div",{children:e.jsx("button",{onClick:E,disabled:j||!o.trim(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"AI 분석 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-ai-generate mr-2"}),"AI로 주문 분석"]})})})]})]})}),l&&e.jsxs("div",{className:"bg-white shadow rounded-lg mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"분석 결과"}),e.jsx("button",{onClick:F,disabled:y,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 whitespace-nowrap",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-700 mr-1"}),"품목 검색 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-search-line mr-1"}),"품목·단가 자동 채우기"]})})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"거래처"}),e.jsx("div",{className:"mt-1 text-lg font-semibold text-gray-900",children:l.customer})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"주문 품목"}),e.jsx("div",{className:"space-y-3",children:n.map((s,t)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 p-4 border border-gray-200 rounded-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"품목코드"}),e.jsx("input",{type:"text",value:s.code,onChange:r=>d(t,"code",r.target.value),className:"mt-1 block w-full text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"품목코드"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"품목명"}),e.jsx("input",{type:"text",value:s.name,onChange:r=>d(t,"name",r.target.value),className:"mt-1 block w-full text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"품목명"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"수량"}),e.jsx("input",{type:"number",value:s.quantity,onChange:r=>d(t,"quantity",parseInt(r.target.value)||0),className:"mt-1 block w-full text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"수량"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"단가"}),e.jsx("input",{type:"number",value:s.price,onChange:r=>d(t,"price",parseFloat(r.target.value)||0),className:"mt-1 block w-full text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"단가"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"단위"}),e.jsx("input",{type:"text",value:s.unit,onChange:r=>d(t,"unit",r.target.value),className:"mt-1 block w-full text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"단위"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"금액"}),e.jsxs("div",{className:"mt-1 text-sm font-medium text-gray-900 py-2",children:[(s.quantity*s.price).toLocaleString(),"원"]})]})]},t))}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"총 주문 금액"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:[n.reduce((s,t)=>s+t.quantity*t.price,0).toLocaleString(),"원"]})]})})]})]})]}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("i",{className:"ri-error-warning-line mr-2 mt-0.5"}),e.jsx("div",{children:k})]})}),I&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-md text-sm mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("i",{className:"ri-check-line mr-2 mt-0.5"}),e.jsx("div",{children:I})]})}),l&&n.length>0&&e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"전표 생성"}),e.jsx("p",{className:"text-sm text-gray-600",children:"확인 후 Ecount 시스템에 판매 전표를 생성합니다"})]}),e.jsx("button",{onClick:q,disabled:v,className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"전표 생성 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-file-add-line mr-2"}),"전표 생성"]})})]})})}),e.jsx("div",{className:"mt-6 bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"사용 예시"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-chat-quote-line mr-2 mt-0.5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("strong",{children:'"A거래처, 깐소새우 96개, 새우볼 50개"'}),e.jsx("p",{children:"→ 거래처: A거래처, 품목: 깐소새우(96개), 새우볼(50개)"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-chat-quote-line mr-2 mt-0.5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("strong",{children:'"삼성전자에 모니터 10대, 키보드 20개 납품"'}),e.jsx("p",{children:"→ 거래처: 삼성전자, 품목: 모니터(10대), 키보드(20개)"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-lightbulb-line mr-2 mt-0.5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("strong",{children:"팁:"})," 거래처명과 품목명, 수량을 명확히 구분하여 입력하면 더 정확한 분석이 가능합니다."]})]})]})]})})]})})}export{$ as default};
//# sourceMappingURL=ai-entry-jy1kb__r.js.map
