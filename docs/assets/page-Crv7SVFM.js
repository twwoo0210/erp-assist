import{d as L,r as d,s as i,j as e,L as N}from"./index-CyyTbw2E.js";function C(){const[v]=L(),l=v.get("order_id"),[r,w]=d.useState(null),[_,k]=d.useState(!0),[n,m]=d.useState(""),[c,x]=d.useState("quote"),[h,u]=d.useState(!1),[g,b]=d.useState(!1),[p,y]=d.useState(!1);d.useEffect(()=>{l&&S()},[l]);const S=async()=>{if(l)try{const{data:s,error:t}=await i.from("order_intake").select(`
          *,
          customer_master (
            customer_name,
            email
          )
        `).eq("id",l).single();if(t)throw t;const{data:o,error:f}=await i.from("order_lines").select(`
          *,
          item_master (
            sku_name,
            uom
          )
        `).eq("order_id",l);if(f)throw f;const j={id:s.id,customer_code:s.customer_code,customer_name:s.customer_master?.customer_name||"",customer_email:s.customer_master?.email,raw_text:s.raw_text,total_amount:s.total_amount,created_at:s.created_at,order_lines:o.map(a=>({sku_code:a.sku_code,sku_name:a.item_master?.sku_name||"",qty:a.qty,unit_price:a.unit_price,discount:a.discount,line_total:a.qty*a.unit_price*(1-a.discount/100),uom:a.item_master?.uom||"EA"}))};w(j),m(j.customer_email||"")}catch(s){console.error("주문 데이터 로드 실패:",s),alert("주문 데이터를 불러올 수 없습니다.")}finally{k(!1)}},D=async()=>{if(r){u(!0);try{const{data:s,error:t}=await i.functions.invoke("generate-docs",{body:{order_id:r.id,doc_type:c}});if(t)throw t;s.pdf_url&&window.open(s.pdf_url,"_blank"),alert("문서가 생성되었습니다.")}catch(s){console.error("문서 생성 실패:",s),alert("문서 생성 중 오류가 발생했습니다.")}finally{u(!1)}}},E=async()=>{if(r){y(!0);try{const{data:s,error:t}=await i.functions.invoke("export-ecount",{body:{order_id:r.id}});if(t)throw t;if(s.download_url){const o=document.createElement("a");o.href=s.download_url,o.download=`ecount_order_${r.id}.csv`,o.click()}alert("이카운트 업로드 파일이 생성되었습니다.")}catch(s){console.error("파일 내보내기 실패:",s),alert("파일 내보내기 중 오류가 발생했습니다.")}finally{y(!1)}}},q=async()=>{if(!r||!n){alert("이메일 주소를 입력해주세요.");return}b(!0);try{const{data:s,error:t}=await i.functions.invoke("send-email",{body:{order_id:r.id,to:n,doc_type:c}});if(t)throw t;alert("이메일이 발송되었습니다.")}catch(s){console.error("이메일 발송 실패:",s),alert("이메일 발송 중 오류가 발생했습니다.")}finally{b(!1)}};return _?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"주문 데이터를 불러오는 중..."})]})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"문서 미리보기"}),e.jsxs("p",{className:"mt-2 text-gray-600",children:["주문 #",r.id.slice(0,8),"... - ",r.customer_name]})]}),e.jsxs(N,{to:"/order-intake",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 whitespace-nowrap",children:[e.jsx("i",{className:"ri-arrow-left-line mr-2"}),"주문 접수로"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"border-b pb-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:c==="quote"?"견적서":"거래명세서"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["발행일: ",new Date(r.created_at).toLocaleDateString("ko-KR")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:"StocksDoctor"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ERP 연동 솔루션"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"고객 정보"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-md",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"고객명:"}),e.jsx("div",{className:"font-medium",children:r.customer_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"고객코드:"}),e.jsx("div",{className:"font-medium",children:r.customer_code})]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"주문 내역"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"품목명"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-center",children:"수량"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"단가"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-center",children:"할인"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"금액"})]})}),e.jsx("tbody",{children:r.order_lines.map((s,t)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:[e.jsx("div",{className:"font-medium",children:s.sku_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.sku_code})]}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 text-center",children:[s.qty," ",s.uom]}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 text-right",children:[s.unit_price.toLocaleString(),"원"]}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 text-center",children:[s.discount,"%"]}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 text-right font-medium",children:[s.line_total.toLocaleString(),"원"]})]},t))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("td",{colSpan:4,className:"border border-gray-300 px-4 py-2 text-right font-bold",children:"총 금액:"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 text-right font-bold text-blue-600",children:[r.total_amount.toLocaleString(),"원"]})]})})]})})]}),r.raw_text&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"원본 주문 내용"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-md",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-700",children:r.raw_text})})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"문서 타입"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"docType",value:"quote",checked:c==="quote",onChange:s=>x(s.target.value),className:"mr-2"}),"견적서"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"docType",value:"invoice",checked:c==="invoice",onChange:s=>x(s.target.value),className:"mr-2"}),"거래명세서"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"문서 생성"}),e.jsx("button",{onClick:D,disabled:h,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 whitespace-nowrap",children:h?"생성 중...":"PDF 생성 및 다운로드"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ERP 연동"}),e.jsx("button",{onClick:E,disabled:p,className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 whitespace-nowrap",children:p?"생성 중...":"이카운트 업로드 파일 생성"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"이메일 발송"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"받는 사람"}),e.jsx("input",{type:"email",value:n,onChange:s=>m(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"이메일 주소"})]}),e.jsx("button",{onClick:q,disabled:g||!n,className:"w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 whitespace-nowrap",children:g?"발송 중...":"이메일 발송"})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-file-search-line text-6xl text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"주문을 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"요청하신 주문 데이터가 존재하지 않습니다."}),e.jsx(N,{to:"/order-intake",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 whitespace-nowrap",children:"주문 접수로 돌아가기"})]})})}export{C as default};
//# sourceMappingURL=page-Crv7SVFM.js.map
