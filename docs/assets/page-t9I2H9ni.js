import{u as A,r as i,j as e,c as k}from"./index-CyyTbw2E.js";const m=k("https://vqcbegbihfnlxnalymog.supabase.co","sb_publishable_AvzF7_UDd1ZQQ8WAINhz0A_ZaQI8gXv");function D(){const h=A(),[l,y]=i.useState("ecount"),[u,x]=i.useState(!1),[_,z]=i.useState(null),[a,E]=i.useState(null),[n,v]=i.useState({isConnected:!1,lastSync:null,itemCount:0,customerCount:0}),[c,p]=i.useState({zoneId:"",comCode:"",apiKey:""}),[d,b]=i.useState({companyName:"",adminEmail:"",phoneNumber:""});i.useEffect(()=>{document.title="ERP Assist 설정 - 이카운트 연동 및 회사 정보 관리";const s=document.querySelector('meta[name="description"]');s&&s.setAttribute("content","이카운트 ERP 연동 설정, 회사 정보 관리, 사용자 권한 설정을 한 곳에서 관리하세요. 안전하고 간편한 API 연동을 지원합니다.");const t=document.createElement("script");return t.type="application/ld+json",t.textContent=JSON.stringify({"@context":"https://schema.org","@type":"WebPage",name:"ERP Assist 설정",description:"이카운트 ERP 연동 설정 및 회사 정보 관리",url:"https://example.com/settings",isPartOf:{"@type":"WebSite",name:"ERP Assist",url:"https://example.com"}}),document.head.appendChild(t),(async()=>{const{data:{user:o}}=await m.auth.getUser();if(z(o),!o){h("/");return}const{data:g}=await m.from("profiles").select("*, organizations(*)").eq("id",o.id).single();if(g&&(E(g),g.organizations)){const r=g.organizations;b({companyName:r.company_name||"",adminEmail:r.admin_email||"",phoneNumber:r.phone_number||""}),p({zoneId:r.ecount_zone_id||"",comCode:r.ecount_com_code||"",apiKey:r.ecount_api_key||""});const{data:j}=await m.from("cached_masters").select("type").eq("organization_id",r.id);if(j){const C=j.filter(N=>N.type==="item").length,S=j.filter(N=>N.type==="customer").length;v({isConnected:C>0||S>0,lastSync:r.updated_at?new Date(r.updated_at).toLocaleString():null,itemCount:C,customerCount:S})}}})(),()=>{const o=document.querySelector('script[type="application/ld+json"]');o&&document.head.removeChild(o)}},[h]);const I=async s=>{s.preventDefault(),x(!0);try{if(!a?.organizations)throw new Error("조직 정보를 찾을 수 없습니다.");const{error:t}=await m.from("organizations").update({ecount_zone_id:c.zoneId,ecount_com_code:c.comCode,ecount_api_key:c.apiKey,updated_at:new Date().toISOString()}).eq("id",a.organizations.id);if(t)throw new Error(t.message);await w(),alert("이카운트 API 연결이 성공적으로 완료되었습니다!")}catch(t){alert(`연결에 실패했습니다: ${t.message}`)}finally{x(!1)}},w=async()=>{x(!0);try{const{data:{session:s}}=await m.auth.getSession();if(!s)throw new Error("로그인이 필요합니다.");const t=await fetch("https://vqcbegbihfnlxnalymog.supabase.co/functions/v1/ecount-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`}});if(!t.ok){const o=await t.json();throw new Error(o.error||"동기화에 실패했습니다.")}const f=await t.json();v({isConnected:!0,lastSync:new Date().toLocaleString(),itemCount:f.itemCount,customerCount:f.customerCount}),alert("마스터 데이터 동기화가 완료되었습니다.")}catch(s){alert(`동기화에 실패했습니다: ${s.message}`)}finally{x(!1)}},P=async s=>{s.preventDefault();try{if(!a?.organizations)throw new Error("조직 정보를 찾을 수 없습니다.");const{error:t}=await m.from("organizations").update({company_name:d.companyName,admin_email:d.adminEmail,phone_number:d.phoneNumber,updated_at:new Date().toISOString()}).eq("id",a.organizations.id);if(t)throw new Error(t.message);alert("회사 정보가 저장되었습니다.")}catch(t){alert(`저장에 실패했습니다: ${t.message}`)}};return _?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-between items-center h-16",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>h("/dashboard"),className:"text-gray-600 hover:text-gray-900 cursor-pointer",children:e.jsx("i",{className:"ri-arrow-left-line text-xl"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"설정"})]})})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>y("ecount"),className:`py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap cursor-pointer ${l==="ecount"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"이카운트 연동"}),e.jsx("button",{onClick:()=>y("organization"),className:`py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap cursor-pointer ${l==="organization"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"회사 정보"}),e.jsx("button",{onClick:()=>y("users"),className:`py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap cursor-pointer ${l==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"사용자 관리"})]})})}),l==="ecount"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"연결 상태"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${n.isConnected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`font-medium ${n.isConnected?"text-green-700":"text-red-700"}`,children:n.isConnected?"연결됨":"연결 안됨"})]}),n.isConnected&&e.jsx("button",{onClick:w,disabled:u,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 cursor-pointer whitespace-nowrap",children:u?"동기화중...":"마스터 동기화"})]}),n.isConnected&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"마지막 동기화"}),e.jsx("p",{className:"font-medium text-gray-900",children:n.lastSync})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"품목 수"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[n.itemCount.toLocaleString(),"개"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"거래처 수"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[n.customerCount,"개"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"이카운트 API 설정"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ZONE ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.zoneId,onChange:s=>p(t=>({...t,zoneId:s.target.value})),placeholder:"예: zone01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["회사 코드 (COM_CODE) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.comCode,onChange:s=>p(t=>({...t,comCode:s.target.value})),placeholder:"예: COM001",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["API 키 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",value:c.apiKey,onChange:s=>p(t=>({...t,apiKey:s.target.value})),placeholder:"이카운트에서 발급받은 API 키를 입력하세요",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("i",{className:"ri-information-line text-blue-600 text-lg mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"API 키 발급 방법:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"이카운트 ERP 로그인"}),e.jsx("li",{children:"시스템관리 > API관리 > OPEN API 설정"}),e.jsx("li",{children:"API 키 발급 후 위에 입력"})]})]})]})}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 cursor-pointer whitespace-nowrap",children:u?"연결 테스트 중...":"저장 및 연결 테스트"})]})]})]}),l==="organization"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"회사 정보"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"회사명"}),e.jsx("input",{type:"text",value:d.companyName,onChange:s=>b(t=>({...t,companyName:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"관리자 이메일"}),e.jsx("input",{type:"email",value:d.adminEmail,onChange:s=>b(t=>({...t,adminEmail:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"연락처"}),e.jsx("input",{type:"tel",value:d.phoneNumber,onChange:s=>b(t=>({...t,phoneNumber:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 cursor-pointer whitespace-nowrap",children:"저장"})]})]}),l==="users"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"사용자 관리"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer whitespace-nowrap",children:"사용자 초대"})]}),e.jsx("div",{className:"space-y-4",children:a&&e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-user-line text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.full_name||"사용자"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.role==="admin"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:a.role==="admin"?"관리자":"멤버"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-more-2-line"})})]})]})})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"로그인 확인 중..."})]})})}export{D as default};
//# sourceMappingURL=page-t9I2H9ni.js.map
