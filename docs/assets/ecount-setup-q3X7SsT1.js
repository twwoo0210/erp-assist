import{r as c,b as w,s as j,j as e}from"./index-CyyTbw2E.js";function I(){const[t,r]=c.useState(1),[n,m]=c.useState({companyCode:"",ecountUserId:""}),[x,d]=c.useState(!1),[f,a]=c.useState(""),[p,u]=c.useState(""),[i,h]=c.useState(null),{user:o}=w();c.useEffect(()=>{o&&g()},[o]);const g=async()=>{try{const{data:s,error:l}=await j.from("ecount_connections").select("*").eq("user_id",o?.id).single();if(l&&l.code!=="PGRST116"){console.error("Error loading connection:",l);return}s&&(h(s),m({companyCode:s.company_code,ecountUserId:s.ecount_user_id}),s.status==="connected"&&r(4))}catch(s){console.error("Error in loadExistingConnection:",s)}},y=s=>{m({...n,[s.target.name]:s.target.value})},b=()=>{if(a(""),t===1){if(!n.companyCode.trim()){a("회사코드를 입력해주세요.");return}r(2)}else if(t===2){if(!n.ecountUserId.trim()){a("Ecount 사용자ID를 입력해주세요.");return}r(3)}},N=async()=>{d(!0),a(""),u("");try{const{data:s,error:l}=await j.functions.invoke("ecount-connection-test",{body:{company_code:n.companyCode,ecount_user_id:n.ecountUserId}});if(l){a(l.message||"Ecount 연결 테스트에 실패했습니다.");return}s.success?(u("Ecount 연결 테스트가 성공했습니다!"),h({companyCode:n.companyCode,ecountUserId:n.ecountUserId,status:"connected",maskedApiKeySuffix:s.masked_api_key_suffix}),r(4),await g()):a(s.message||"연결 테스트에 실패했습니다.")}catch(s){a(s.message||"Ecount 연결 테스트 중 오류가 발생했습니다.")}finally{d(!1)}},v=async()=>{if(confirm("Ecount 연결을 해제하시겠습니까?")){d(!0),a("");try{const{error:s}=await j.from("ecount_connections").update({status:"disconnected"}).eq("user_id",o?.id);if(s){a("연결 해제 중 오류가 발생했습니다.");return}h(null),m({companyCode:"",ecountUserId:""}),r(1),u("Ecount 연결이 해제되었습니다.")}catch{a("연결 해제 중 오류가 발생했습니다.")}finally{d(!1)}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Ecount 연결 설정"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Ecount ERP 시스템과 연결하여 주문 데이터를 동기화하세요"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex items-center space-x-4",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${t>=s?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:s===4&&i?.status==="connected"?e.jsx("i",{className:"ri-check-line"}):s}),s<4&&e.jsx("div",{className:`w-8 h-0.5 ${t>s?"bg-blue-600":"bg-gray-200"}`})]},s))})}),e.jsxs("div",{className:"mt-2 text-center text-xs text-gray-500",children:[t===1&&"회사코드 입력",t===2&&"Ecount 사용자ID 입력",t===3&&"API Key 확인 및 연결 테스트",t===4&&"연결 완료"]})]}),e.jsx("div",{className:"bg-white shadow sm:rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[f&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm",children:f}),p&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-md text-sm",children:p}),t===1&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"1단계: 회사코드 입력"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"companyCode",className:"block text-sm font-medium text-gray-700",children:"Ecount 회사코드"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("input",{id:"companyCode",name:"companyCode",type:"text",value:n.companyCode,onChange:y,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"예: 669606"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Ecount 관리자에게 문의하여 회사코드를 확인하세요"})]})]})})]}),t===2&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"2단계: Ecount 사용자ID 입력"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ecountUserId",className:"block text-sm font-medium text-gray-700",children:"Ecount 사용자ID"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("input",{id:"ecountUserId",name:"ecountUserId",type:"text",value:n.ecountUserId,onChange:y,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"예: EUNYUL0331"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Ecount 로그인에 사용하는 사용자ID를 입력하세요"})]})]})})]}),t===3&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"3단계: API Key 확인 및 연결 테스트"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-information-line text-blue-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"API Key 보안 안내"}),e.jsx("div",{className:"mt-2 text-sm text-blue-700",children:e.jsxs("p",{children:["보안을 위해 API Key는 화면에 입력하지 않습니다.",e.jsx("br",{}),"운영팀이 안전한 서버 환경에 미리 보관했습니다."]})})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"입력된 정보"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"회사코드:"}),e.jsx("span",{className:"font-mono",children:n.companyCode})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"사용자ID:"}),e.jsx("span",{className:"font-mono",children:n.ecountUserId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"API Key:"}),e.jsx("span",{className:"text-gray-500",children:"****6306 (서버에 보관됨)"})]})]})]})]})]}),t===4&&i?.status==="connected"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"4단계: 연결 완료"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-check-circle-line text-green-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800",children:"Ecount 연결 성공!"}),e.jsx("div",{className:"mt-2 text-sm text-green-700",children:e.jsxs("p",{children:["Ecount ERP 시스템과 성공적으로 연결되었습니다.",e.jsx("br",{}),"이제 주문 데이터를 자동으로 동기화할 수 있습니다."]})})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"연결 정보"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"상태:"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"연결됨"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"회사코드:"}),e.jsx("span",{className:"font-mono",children:i.companyCode})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"사용자ID:"}),e.jsx("span",{className:"font-mono",children:i.ecountUserId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"API Key:"}),e.jsxs("span",{className:"text-gray-500",children:["****",i.maskedApiKeySuffix]})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>window.location.href="/orders/ai-entry",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 whitespace-nowrap",children:"AI 주문 입력 시작하기"}),e.jsx("button",{type:"button",onClick:v,disabled:x,className:"px-4 py-2 border border-red-300 text-red-700 rounded-md text-sm font-medium hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50 whitespace-nowrap",children:"연결 해제"})]})]})]}),t<4&&e.jsxs("div",{className:"flex justify-between mt-8",children:[t>1&&e.jsx("button",{type:"button",onClick:()=>r(t-1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 whitespace-nowrap",children:"이전"}),t<3?e.jsx("button",{type:"button",onClick:b,className:`px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 whitespace-nowrap ${t===1?"w-full":"ml-auto"}`,children:"다음"}):e.jsx("button",{type:"button",onClick:N,disabled:x,className:"ml-auto px-4 py-2 bg-green-600 text-white rounded-md text-sm font-medium hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 whitespace-nowrap",children:x?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"연결 테스트 중..."]}):"연결 테스트"})]})]})}),e.jsx("div",{className:"mt-8 bg-white shadow sm:rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"도움말"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-question-line text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"회사코드를 모르겠어요"}),e.jsx("br",{}),"Ecount 관리자 또는 IT 담당자에게 문의하여 회사코드를 확인하세요."]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-question-line text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"연결 테스트가 실패해요"}),e.jsx("br",{}),"회사코드와 사용자ID가 정확한지 확인하고, Ecount 계정이 활성화되어 있는지 확인하세요."]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-shield-check-line text-green-500 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"보안이 걱정돼요"}),e.jsx("br",{}),"모든 API Key는 암호화되어 안전한 서버에 저장되며, 화면에 노출되지 않습니다."]})]})]})]})})]})})}export{I as default};
//# sourceMappingURL=ecount-setup-q3X7SsT1.js.map
