import{b as O,r as c,s as u,j as e}from"./index-TUPhGR7w.js";function I(){const{user:v}=O(),[N,_]=c.useState([]),[o,w]=c.useState(""),[i,x]=c.useState(""),[h,b]=c.useState([]),[a,l]=c.useState([]),[p,g]=c.useState(!1),[f,y]=c.useState(!1);c.useEffect(()=>{k()},[]);const k=async()=>{try{const{data:s,error:t}=await u.from("customer_master").select("*").eq("active",!0).order("customer_name");if(t)throw t;_(s||[])}catch(s){console.error("고객 목록 로드 실패:",s)}},C=async()=>{if(!i.trim()||!o){alert("고객과 주문 내용을 입력해주세요.");return}g(!0);try{const{data:s,error:t}=await u.functions.invoke("suggest-items",{body:{raw_text:i,customer_code:o}});if(t)throw t;b(s.suggestions||[])}catch(s){console.error("품목 제안 실패:",s),alert("품목 제안 중 오류가 발생했습니다.")}finally{g(!1)}},S=s=>{const t=a.findIndex(r=>r.sku_code===s.sku_code);if(t>=0){const r=[...a];r[t].qty+=1,r[t].line_total=r[t].qty*r[t].unit_price*(1-r[t].discount/100),l(r)}else{const r={sku_code:s.sku_code,sku_name:s.sku_name,qty:1,unit_price:s.unit_price,discount:0,line_total:s.unit_price,uom:s.uom};l([...a,r])}},m=(s,t,r)=>{const n=[...a];n[s]={...n[s],[t]:r},(t==="qty"||t==="unit_price"||t==="discount")&&(n[s].line_total=n[s].qty*n[s].unit_price*(1-n[s].discount/100)),l(n)},L=s=>{l(a.filter((t,r)=>r!==s))},j=()=>a.reduce((s,t)=>s+t.line_total,0),q=async()=>{if(!o||a.length===0){alert("고객과 주문 라인을 확인해주세요.");return}y(!0);try{const{data:s,error:t}=await u.from("order_intake").insert({user_id:v?.id,customer_code:o,raw_text:i,status:"draft",total_amount:j()}).select().single();if(t)throw t;const r=a.map(d=>({order_id:s.id,sku_code:d.sku_code,qty:d.qty,unit_price:d.unit_price,discount:d.discount})),{error:n}=await u.from("order_lines").insert(r);if(n)throw n;alert("주문이 저장되었습니다."),x(""),b([]),l([])}catch(s){console.error("주문 저장 실패:",s),alert("주문 저장 중 오류가 발생했습니다.")}finally{y(!1)}};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"주문 접수"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"자연어로 주문을 입력하면 품목을 자동으로 제안해드립니다."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"주문 정보 입력"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["고객 선택 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o,onChange:s=>w(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"고객을 선택하세요"}),N.map(s=>e.jsxs("option",{value:s.customer_code,children:[s.customer_name," (",s.channel,")"]},s.customer_code))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["주문 내용 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:i,onChange:s=>x(s.target.value),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"예: A거래처, 깐새우 100개, 광어 50마리"})]}),e.jsx("button",{onClick:C,disabled:p,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 whitespace-nowrap",children:p?"분석 중...":"품목 제안"})]})]}),h.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"품목 제안 결과"}),e.jsx("div",{className:"space-y-3",children:h.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.sku_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.sku_code," | 단가: ",s.unit_price.toLocaleString(),"원/",s.uom," | 재고: ",s.stock_qty,s.uom," | 유사도: ",(s.confidence*100).toFixed(0),"%"]})]}),e.jsx("button",{onClick:()=>S(s),className:"ml-4 bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 whitespace-nowrap",children:"추가"})]},t))})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"주문 확정"}),a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"ri-shopping-cart-line text-4xl mb-2"}),e.jsx("p",{children:"선택된 품목이 없습니다."})]}):e.jsxs("div",{className:"space-y-4",children:[a.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.sku_name}),e.jsx("button",{onClick:()=>L(t),className:"text-red-600 hover:text-red-800",children:e.jsx("i",{className:"ri-delete-bin-line"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"수량"}),e.jsx("input",{type:"number",min:"1",value:s.qty,onChange:r=>m(t,"qty",parseInt(r.target.value)||1),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"단가"}),e.jsx("input",{type:"number",min:"0",value:s.unit_price,onChange:r=>m(t,"unit_price",parseFloat(r.target.value)||0),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"할인(%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:s.discount,onChange:r=>m(t,"discount",parseFloat(r.target.value)||0),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mt-2 text-right text-sm font-medium text-gray-900",children:["소계: ",s.line_total.toLocaleString(),"원"]})]},t)),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{children:"총 금액:"}),e.jsxs("span",{className:"text-blue-600",children:[j().toLocaleString(),"원"]})]})}),e.jsx("button",{onClick:q,disabled:f,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 whitespace-nowrap",children:f?"저장 중...":"주문 저장"})]})]})})]})]})})}export{I as default};
//# sourceMappingURL=page-CvnRdtGR.js.map
